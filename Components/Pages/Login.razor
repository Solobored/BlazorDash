@page "/login"
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.AspNetCore.WebUtilities
@inject NavigationManager NavigationManager

<PageTitle>Blazor Dash - Login</PageTitle>

<div class="auth-container">
  <div class="auth-card">
    <div class="auth-header">
      <h1>ğŸ® Blazor Dash Login</h1>
      <p class="auth-subtitle">Sign in to save your scores</p>
    </div>

    @if (!string.IsNullOrEmpty(errorMessage))
    {
      <div class="alert alert-danger" role="alert">
        <span class="alert-icon">âš ï¸</span>
        <div class="alert-content">
          <strong>Error:</strong> @errorMessage
        </div>
      </div>
    }

    <form method="post" action="/login-handler" class="auth-form">
      <div class="form-group">
        <label for="email">
          <span class="label-icon">ğŸ“§</span>
          Email Address
        </label>
        <input type="email" id="email" name="Email" class="form-control" 
               placeholder="your@email.com" required 
               value="@loginEmail" />
      </div>

      <div class="form-group">
        <label for="password">
          <span class="label-icon">ğŸ”’</span>
          Password
        </label>
        <input type="password" id="password" name="Password" class="form-control"
               placeholder="Enter your password" required />
      </div>

      <div class="form-group form-check">
        <input type="checkbox" id="rememberMe" name="RememberMe" class="form-check-input" />
        <label class="form-check-label" for="rememberMe">Remember me</label>
      </div>

      <button type="submit" class="btn btn-primary btn-block">
        <span class="btn-icon">ğŸš€</span>
        Sign In
      </button>
    </form>

    <div class="auth-footer">
      <p>Don't have an account? <a href="/register" class="auth-link">Create one here</a></p>
      <a href="/" class="auth-link back-link">â† Back to Home</a>
    </div>
  </div>
</div>

@code {
  private string? errorMessage;
  private string loginEmail = "";

  protected override void OnInitialized()
  {
    // Check for error query parameter
    var uri = NavigationManager.ToAbsoluteUri(NavigationManager.Uri);
    var query = QueryHelpers.ParseQuery(uri.Query);
    if (query.TryGetValue("error", out var error))
    {
      errorMessage = error.ToString();
    }
    if (query.TryGetValue("email", out var email))
    {
      loginEmail = email.ToString();
    }
  }
}